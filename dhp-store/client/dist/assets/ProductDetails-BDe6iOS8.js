import{u as P,a as E,b as F,c as $,r as i,d as C,j as e,e as B,f as L,R as O,C as N}from"./index-BSVildoF.js";function T(){const{id:n}=P(),r=E(),{add:R,totalQty:x}=F(),{token:g,name:S}=$(),[s,w]=i.useState(null),[k,f]=i.useState(!0),[c,A]=i.useState(null),[y,z]=i.useState(1),[j,l]=i.useState(!1),o=i.useRef(null),d=i.useRef(null),[u,p]=i.useState(null),[I,h]=i.useState([]);if(i.useEffect(()=>{C.get(`/products/${n}`).then(t=>{w(t.data),f(!1)}).catch(t=>{console.error("Failed to fetch product",t),f(!1)})},[n]),i.useEffect(()=>{n&&C.get(`/recommend/product/${n}`).then(t=>{Array.isArray(t.data)?h(t.data):(console.warn("Unexpected AI response:",t.data),h([]))}).catch(t=>{console.error("Recs error:",t),h([])})},[n]),k)return e.jsx("div",{style:{padding:40,textAlign:"center"},children:"Loading product..."});if(!s)return e.jsx("div",{style:{padding:40,textAlign:"center"},children:"Product not found."});const m=s.sizes?s.sizes.split(","):[],b=t=>{z(a=>Math.max(1,a+t))},q=()=>{if(!o.current||!d.current)return;const t=o.current.getBoundingClientRect(),a=d.current.getBoundingClientRect();p({src:s.image_url,style:{position:"fixed",top:t.top,left:t.left,width:t.width,height:t.height,opacity:1,zIndex:9999,borderRadius:"12px",pointerEvents:"none",transition:"none"}}),requestAnimationFrame(()=>{setTimeout(()=>{p({src:s.image_url,style:{position:"fixed",top:a.top+10,left:a.left+10,width:"20px",height:"20px",opacity:0,zIndex:9999,borderRadius:"50%",pointerEvents:"none",transition:"all 0.8s cubic-bezier(0.2, 1, 0.3, 1)"}})},20)}),setTimeout(()=>p(null),850)},v=async(t=!1)=>{if(m.length>0&&!c){alert("Please select a size first.");return}await R(s.id,y,c)&&(t?r("/checkout"):q())};return e.jsxs(e.Fragment,{children:[u&&e.jsx("img",{src:u.src,style:u.style,className:"flying-item",alt:""}),e.jsxs("div",{className:"home-icons",style:{display:"flex",alignItems:"center",padding:"20px 40px"},children:[e.jsx("button",{onClick:()=>r(-1),style:{position:"relative",color:"black",fontSize:18,cursor:"pointer",borderRadius:8,border:"1px solid rgba(0,0,0,0.12)",background:"white",top:10,left:30,padding:"10px 14px"},children:"← Back"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:20,marginLeft:"auto"},children:[e.jsxs("div",{ref:d,style:{position:"relative"},children:[e.jsx("img",{src:B,alt:"Cart",title:"Cart",onClick:()=>l(!0),style:{width:32,height:32,cursor:"pointer"}}),x>0&&e.jsx("span",{style:{position:"absolute",bottom:-5,left:-5,background:"black",color:"white",borderRadius:"50%",padding:"2px 6px",fontSize:12,fontWeight:"bold",minWidth:18,textAlign:"center"},children:x})]}),e.jsx("img",{src:L,alt:"Account",title:g?`Account (${S||"me"})`:"Login / Register",onClick:()=>r(g?"/account":"/login"),style:{width:32,height:32,cursor:"pointer"}})]})]}),e.jsxs("div",{className:"pdp-container fade-in",children:[e.jsx("div",{className:"pdp-image-container",children:e.jsx("img",{ref:o,src:s.image_url,alt:s.name,className:"pdp-image"})}),e.jsxs("div",{className:"pdp-info",children:[e.jsx("h1",{className:"pdp-name",children:s.name}),e.jsxs("div",{className:"pdp-price",children:["$",Number(s.price).toFixed(2)]}),e.jsx("p",{style:{color:"#666",lineHeight:"1.5"},children:s.description||"A classic essential for your wardrobe. Made with high-quality materials for lasting comfort and style."}),m.length>0&&e.jsxs("div",{className:"size-section",children:[e.jsxs("h4",{children:["Select Size: ",c]}),e.jsx("div",{className:"size-grids",children:m.map(t=>e.jsx("div",{className:`size-box ${c===t?"selected":""}`,onClick:()=>A(t),children:t},t))})]}),e.jsxs("div",{className:"qty-section",children:[e.jsx("h4",{children:"Quantity"}),e.jsxs("div",{className:"qty-wrapper",children:[e.jsx("button",{className:"qty-btn",onClick:()=>b(-1),children:"−"}),e.jsx("div",{className:"qty-display",children:y}),e.jsx("button",{className:"qty-btn",onClick:()=>b(1),children:"+"})]})]}),e.jsxs("div",{className:"pdp-actions",children:[e.jsx("button",{className:"btn-add-cart",onClick:()=>v(!1),children:"Add to Cart"}),e.jsx("button",{className:"btn-buy-now",onClick:()=>v(!0),children:"Buy Now"})]})]})]}),e.jsx(O,{title:"Similar Products",products:I}),e.jsx(N,{isOpen:j,onClose:()=>l(!1)}),e.jsx(N,{isOpen:j,onClose:()=>l(!1)})]})}export{T as default};
